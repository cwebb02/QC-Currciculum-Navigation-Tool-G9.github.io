<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade 9 Math Mastery Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        .mild { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .medium { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
        .spicy { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .extra { background: #450a0a; color: #fecaca; border: 1px solid #7f1d1d; }
        
        /* Smooth transition for the icon fills */
        stop { transition: offset 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Tab active state transition */
        .tab-btn { transition: all 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans flex flex-col min-h-screen">

    <div class="bg-slate-900 text-white p-4 shadow-lg z-50">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex-1 text-center md:text-left">
                <h1 class="text-xl md:text-3xl font-bold tracking-tight">Math Mastery Tracker</h1>
                <p class="text-slate-400 text-xs md:text-sm">Grade 9 Curriculum (Quebec)</p>
            </div>

            <div class="flex gap-4 justify-center">
                
                <div class="flex items-center gap-2 bg-slate-800 p-3 rounded-lg border border-slate-700 min-w-[150px]">
                    <svg height="45" width="45" viewBox="0 0 100 100" class="drop-shadow-lg">
                        <defs>
                            <linearGradient id="bulbGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                                <stop id="bulb-stop-yellow" offset="0%" style="stop-color:#fbbf24; stop-opacity:1" /> 
                                <stop id="bulb-stop-gray" offset="0%" style="stop-color:#374151; stop-opacity:1" />   
                            </linearGradient>
                        </defs>
                        <path fill="url(#bulbGradient)" stroke="white" stroke-width="2"
                              d="M50,10 C30.67,10,15,25.67,15,45 c0,11.3,5.6,21.3,14.3,27.6 c2.6,1.9,4.2,4.9,4.2,8.1 v5.8 c0,4.7,3.8,8.5,8.5,8.5 h16 c4.7,0,8.5-3.8,8.5-8.5 v-5.8 c0-3.2,1.6-6.2,4.2-8.1 C79.4,66.3,85,56.3,85,45 C85,25.67,69.33,10,50,10 z" />
                    </svg>
                    <div class="text-right flex-1">
                        <div class="text-2xl font-bold text-yellow-400" id="core-progress">0%</div>
                        <div class="text-[9px] text-slate-400 uppercase tracking-widest leading-tight">Core Mastery<br>(Mild/Med)</div>
                    </div>
                </div>

                <div class="flex items-center gap-2 bg-slate-800 p-3 rounded-lg border border-slate-700 min-w-[150px]">
                    <svg height="45" width="45" viewBox="0 0 100 100" class="drop-shadow-lg">
                        <defs>
                            <linearGradient id="chiliGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                                <stop id="chili-stop-red" offset="0%" style="stop-color:#ef4444; stop-opacity:1" /> 
                                <stop id="chili-stop-gray" offset="0%" style="stop-color:#374151; stop-opacity:1" /> 
                            </linearGradient>
                        </defs>
                        <path fill="url(#chiliGradient)" stroke="white" stroke-width="2" 
                              d="M68,20 C82,20 88,35 82,55 C76,75 55,90 30,95 C45,85 58,65 60,45 C62,32 56,26 52,20 Z" />
                        <path fill="#22c55e" stroke="none" 
                              d="M52,20 L68,20 C70,18 72,15 70,12 C68,10 65,12 63,14 C60,12 55,10 52,12 C48,14 50,18 52,20 L58,10 Z" />
                    </svg>
                    <div class="text-right flex-1">
                        <div class="text-2xl font-bold text-red-500" id="spicy-progress">0%</div>
                        <div class="text-[9px] text-slate-400 uppercase tracking-widest leading-tight">Spicy Level<br>(Challenge)</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="bg-white border-b border-slate-200 sticky top-0 z-40">
        <div class="max-w-6xl mx-auto flex">
            <button onclick="switchTab('tracker')" id="btn-tracker" class="tab-btn flex-1 py-4 text-center font-bold text-slate-600 border-b-2 border-transparent hover:text-blue-600 hover:bg-slate-50">
                ðŸ“Š Mastery Tracker
            </button>
            <button onclick="switchTab('docs')" id="btn-docs" class="tab-btn flex-1 py-4 text-center font-bold text-slate-600 border-b-2 border-transparent hover:text-blue-600 hover:bg-slate-50">
                ðŸ“„ Course Docs
            </button>
        </div>
    </div>

    <div class="max-w-6xl mx-auto w-full flex-1 p-4 md:p-6">
        
        <div id="tab-tracker" class="block">
            <div class="flex flex-col md:flex-row gap-4 mb-8 sticky top-20 z-30 bg-slate-50 py-4 border-b border-slate-200">
                <input type="text" id="search-input" placeholder="Search skills (e.g., 'slope', 'sphere', 'inequality')..." 
                       class="flex-1 p-3 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 outline-none">
                <button onclick="resetProgress()" class="px-6 py-3 text-sm font-medium text-red-600 bg-white border border-red-200 rounded-lg hover:bg-red-50 transition">Reset</button>
            </div>

            <div id="curriculum-container" class="space-y-6 pb-20">
                <div id="loading-msg" class="text-center text-gray-500 py-10">Loading data...</div>
            </div>
        </div>

        <div id="tab-docs" class="hidden h-full">
            <div class="bg-white p-2 rounded-lg shadow-sm border border-slate-200 h-[85vh]">
                <iframe src="https://docs.google.com/document/d/e/2PACX-1vTF981yCbbZ3Fu7UOIWGFK0-wmIxQgMt2Y_c6WVAAWwbOfwSyd6nWYa8O99szeUEQaPS6jfJfdbHSbt/pub?embedded=true" 
                        class="w-full h-full rounded border-0" 
                        allowfullscreen></iframe>
            </div>
        </div>

    </div>

    <script>
    // --- 1. FULL DATASET ---
    const curriculumData = [
        {
            category: "Arithmetic | Real Numbers",
            topics: [
                {
                    title: "Rational, Irrational, and Real Numbers",
                    skills: [
                        { level: "Mild", text: "I can define the real number system as the combination of rational and irrational numbers." },
                        { level: "Mild", text: "I can link the real number system to the number line." },
                        { level: "Medium", text: "I can categorize a real number as either rational or irrational." },
                        { level: "Spicy", text: "I can convert repeating decimals to fractions." },
                        { level: "Spicy", text: "I can represent real numbers (and subsets) using set builder notation." }
                    ]
                },
                {
                    title: "Interval Notation",
                    skills: [
                        { level: "Mild", text: "I can represent a simple inequality verbally, algebraically, numerically, and graphically." },
                        { level: "Medium", text: "I can represent a compound inequality (AND) verbally, algebraically, numerically, and graphically." },
                        { level: "Spicy", text: "I can represent a compound inequality (OR) verbally, algebraically, numerically, and graphically." }
                    ]
                },
                {
                    title: "Cubes & Cube Roots",
                    skills: [
                        { level: "Mild", text: "I can identify perfect cubes (and cube roots)." },
                        { level: "Medium", text: "I can link cubed numbers and cube roots to different contexts (e.g. side length vs volume)." }
                    ]
                },
                {
                    title: "Fractional Exponents",
                    skills: [
                        { level: "Mild", text: "I understand that a fractional exponent represents both a power (numerator) and a root (denominator)." },
                        { level: "Medium", text: "I can evaluate a power with a fractional exponent." },
                        { level: "Medium", text: "I can convert a root to a fractional exponent." },
                        { level: "Spicy", text: "I can simplify expressions with exponents with fractional exponents." }
                    ]
                },
                {
                    title: "Negative Exponents",
                    skills: [
                        { level: "Mild", text: "I understand negative exponents represent repeated division." },
                        { level: "Mild", text: "I can rewrite a negative exponent as a positive exponent using division." },
                        { level: "Medium", text: "I can combine positive and negative exponents for like bases." }
                    ]
                },
                {
                    title: "Operations Involving Exponents",
                    skills: [
                        { level: "Mild", text: "I can perform operations with exponents with whole number bases and whole number exponents." },
                        { level: "Medium", text: "I can perform operations with exponents with positive and negative (integer) bases and whole number exponents." },
                        { level: "Spicy", text: "I can perform operations with exponents with positive and negative fractional (rational) bases and whole number exponents." },
                        { level: "Spicy", text: "I can perform operations with exponents with positive and negative (integer) bases and fractional (rational) number exponents." },
                        { level: "Extra Spicy", text: "I can perform operations with exponents with positive and negative fractional (rational) bases and fractional (rational) number exponents." }
                    ]
                },
                {
                    title: "Exponent Laws",
                    skills: [
                        { level: "Mild", text: "I understand that exponents represents repeated multiplication." },
                        { level: "Mild", text: "I understand special exponents (Power of 0 is 1; Exponent 1 changes nothing)." },
                        { level: "Mild", text: "I can collect like terms." },
                        { level: "Mild", text: "I can list the exponent laws (Product, Quotient, Power of Product/Quotient, Power of a Power)." },
                        { level: "Mild", text: "I can simplify an expression using a single exponent law for numerical and algebraic bases." },
                        { level: "Medium", text: "I can justify the exponent laws." },
                        { level: "Medium", text: "I can simplify an expression using two or more exponent laws." },
                        { level: "Medium", text: "I can rewrite an exponential expression using only positive exponents." },
                        { level: "Spicy", text: "I can apply exponents laws combined with Geometry (area/Pythagorean) and dividing fractions." }
                    ]
                },
                {
                    title: "Scientific Notation",
                    skills: [
                        { level: "Mild", text: "I can convert numbers to and from scientific notation." },
                        { level: "Medium", text: "I can perform operations with numbers in scientific notation." },
                        { level: "Spicy", text: "I can solve word problems that require converting and/or performing operations in scientific notation." }
                    ]
                },
                {
                    title: "Order of Magnitude",
                    skills: [
                        { level: "Mild", text: "I can associate orders of magnitude with both metric prefixes and place value." },
                        { level: "Medium", text: "I can estimate the order of magnitude using either the metric prefix or the place value." },
                        { level: "Spicy", text: "I can compare two or more things using their relative orders of magnitude." }
                    ]
                }
            ]
        },
        {
            category: "Algebra | Expressions",
            topics: [
                {
                    title: "Multiplying Polynomials",
                    skills: [
                        { level: "Mild", text: "I can multiply a monomial by a polynomial (with one or more variables)." },
                        { level: "Medium", text: "I can multiply two binomials." },
                        { level: "Spicy", text: "I can multiply a binomial by a trinomial." },
                        { level: "Spicy", text: "I can square a binomial." },
                        { level: "Spicy", text: "I can use algebraic identities." },
                        { level: "Extra Spicy", text: "I can multiply polynomials with three or more terms by other polynomials with three or more terms." }
                    ]
                },
                {
                    title: "Dividing a Polynomial by a Monomial",
                    skills: [
                        { level: "Mild", text: "I can divide a polynomial by a constant." },
                        { level: "Medium", text: "I can divide a polynomial by a monomial." },
                        { level: "Spicy", text: "I can use division in context to solve problems (e.g. algebraic geometry)." },
                        { level: "Extra Spicy", text: "I can divide a polynomial by a binomial by either factoring or using long division." }
                    ]
                },
                {
                    title: "Factoring Polynomials",
                    skills: [
                        { level: "Mild", text: "I can identify the numerical and algebraic greatest common factor (GCF)." },
                        { level: "Medium", text: "I can completely factor out a polynomial by a monomial." },
                        { level: "Spicy", text: "I can factor out a binomial." },
                        { level: "Extra Spicy", text: "I can factor a trinomial." }
                    ]
                }
            ]
        },
        {
            category: "Algebra | Equations & Inequalities",
            topics: [
                {
                    title: "Solving Equations",
                    skills: [
                        { level: "Mild", text: "I can solve a one-step equation." },
                        { level: "Medium", text: "I can solve a two-step equation." },
                        { level: "Spicy", text: "I can solve a multi-step equation." }
                    ]
                },
                {
                    title: "Solving Fractional Equations",
                    skills: [
                        { level: "Mild", text: "I can solve an equation which includes a fraction." },
                        { level: "Medium", text: "I can solve an equation which has fractions on both sides." },
                        { level: "Spicy", text: "I can solve an equation where I need to find a common denominator." }
                    ]
                },
                {
                    title: "Inequalities",
                    skills: [
                        { level: "Mild", text: "I can recognize an inequality and identify greater/smaller expressions based on symbols." },
                        { level: "Mild", text: "I understand the difference between strict and inclusive inequalities." },
                        { level: "Medium", text: "I can translate a written description to a single variable inequality." }
                    ]
                },
                {
                    title: "Solving First Degree Inequalities",
                    skills: [
                        { level: "Mild", text: "I can solve an inequality using inverse operations." },
                        { level: "Medium", text: "I can identify situations where multiplying/dividing by a negative flips the inequality." },
                        { level: "Spicy", text: "I can solve compound inequalities." }
                    ]
                }
            ]
        },
        {
            category: "Algebra | Relations",
            topics: [
                {
                    title: "Relations & Functions",
                    skills: [
                        { level: "Mild", text: "I can identify independent/dependent variables and define relation vs function." },
                        { level: "Medium", text: "I can identify if a relation is a function." },
                        { level: "Medium", text: "I can identify properties: Domain, Range, Increase/Decrease, Sign, Extrema, Intercepts." },
                        { level: "Spicy", text: "I can construct a context given properties or sketch a graph from properties." }
                    ]
                },
                {
                    title: "Modes of Representation",
                    skills: [
                        { level: "Mild", text: "I can identify different modes of representing a relation (verbal, algebraic, table, graph)." },
                        { level: "Medium", text: "I can convert between representations and interpret situations." },
                        { level: "Spicy", text: "I can model a real world situation using one or more modes of representation." }
                    ]
                },
                {
                    title: "Slope",
                    skills: [
                        { level: "Mild", text: "I can calculate rate of change from a graph or equation." },
                        { level: "Medium", text: "I can calculate rate of change between two points using the formula." },
                        { level: "Medium", text: "I can calculate rate of change given a table or word problem." }
                    ]
                },
                {
                    title: "Rule of a Linear Function",
                    skills: [
                        { level: "Mild", text: "I can identify input/output variables and calculate output given a rule." },
                        { level: "Medium", text: "I understand y=mx+b form and can solve for input or output variables." },
                        { level: "Medium", text: "I can write a simple linear rule given a rate and initial value." },
                        { level: "Spicy", text: "I can determine the rule (y=mx+b) from a table, graph, or two points." },
                        { level: "Spicy", text: "I can write a rule to model a situational problem and use it to solve the problem." }
                    ]
                },
                {
                    title: "Constant, Direct, Indirect Variation",
                    skills: [
                        { level: "Mild", text: "I can recognize constant, direct, and indirect variation situations." },
                        { level: "Medium", text: "I can identify direct (y=kx) and indirect (xy=k) variations." },
                        { level: "Medium", text: "I can determine the constant of variation (k) and write the rule." },
                        { level: "Spicy", text: "I can differentiate variations from tables/graphs and solve problems." },
                        { level: "Spicy", text: "I can graph direct/indirect variations and translate situational problems into models." }
                    ]
                },
                {
                    title: "Models a Linear Function",
                    skills: [
                        { level: "Mild", text: "I can identify dependent/independent variables and start/rate in simple situations." },
                        { level: "Medium", text: "I can identify initial value (b) and rate (m) to write y=mx+b rule." },
                        { level: "Spicy", text: "I can create a linear model from a problem requiring rate calculation from data points." },
                        { level: "Spicy", text: "I can interpret slope and y-intercept in context and determine domain/range." }
                    ]
                },
                {
                    title: "Inverse Variation (Rational)",
                    skills: [
                        { level: "Mild", text: "I can recognize inverse relationships and complete simple tables (constant product)." },
                        { level: "Medium", text: "I can identify inverse variation from a table, find k, and write the rule (y=k/x)." },
                        { level: "Spicy", text: "I can model situational problems and recognize the hyperbola graph/asymptotes." },
                        { level: "Spicy", text: "I can explain impossible values (e.g., x=0)." },
                        { level: "Extra Spicy", text: "I can compare inverse variation with other relationships and explore asymptotes formally." }
                    ]
                },
                {
                    title: "Inverse of a Function",
                    skills: [
                        { level: "Mild", text: "I understand an inverse 'undoes' a relationship and can swap table values." },
                        { level: "Medium", text: "I can find the inverse rule algebraically and understand the graph reflection (y=x)." },
                        { level: "Spicy", text: "I can find inverse rules from different forms and interpret meaning in context." },
                        { level: "Spicy", text: "I can determine domain and range of an inverse function." }
                    ]
                },
                {
                    title: "Systems of Equations",
                    skills: [
                        { level: "Mild", text: "I can recognize when a situation can be represented by a system of equations." },
                        { level: "Medium", text: "I can represent a system using tables, graphs, or equations." },
                        { level: "Medium", text: "I can interpret the solution (point of intersection)." },
                        { level: "Spicy", text: "I can represent a system with more than two equations." },
                        { level: "Mild", text: "I can solve a system using a table or graph." },
                        { level: "Medium", text: "I can solve a system algebraically using comparison." },
                        { level: "Spicy", text: "I understand types of solutions (unique, none, infinite) and can solve using substitution/elimination." }
                    ]
                }
            ]
        },
        {
            category: "Geometry",
            topics: [
                {
                    title: "Surface Area of Cones",
                    skills: [
                        { level: "Mild", text: "I can identify radius, height, slant height and calculate base/lateral area." },
                        { level: "Medium", text: "I can use Pythagorean theorem to find dimensions and use formulas for area." }
                    ]
                },
                {
                    title: "Surface Area of Spheres",
                    skills: [
                        { level: "Mild", text: "I can identify radius/diameter and calculate surface area (SA=4Ï€rÂ²)." },
                        { level: "Medium", text: "I can find radius from diameter, calculate hemisphere SA, and work backwards." },
                        { level: "Spicy", text: "I can solve multi-step problems involving spheres and analyze radius changes." }
                    ]
                },
                {
                    title: "Decomposable Solids",
                    skills: [
                        { level: "Mild", text: "I can identify basic solids and add volumes of simple parts." },
                        { level: "Medium", text: "I can decompose solids into prisms, cylinders, etc., and sum volumes." },
                        { level: "Spicy", text: "I can analyze complex solids, handle cavities (negative volume), and solve multi-step problems." }
                    ]
                },
                {
                    title: "Volume",
                    skills: [
                        { level: "Mild", text: "I can identify shapes and recall volume formulas for cylinders, cones, spheres." },
                        { level: "Medium", text: "I can calculate volumes given dimensions and solve one-step word problems." },
                        { level: "Medium", text: "I can work backwards to find missing dimensions from volume." },
                        { level: "Spicy", text: "I can solve multi-step word problems involving these solids." }
                    ]
                },
                {
                    title: "Capacity",
                    skills: [
                        { level: "Mild", text: "I can identify metric units of volume/capacity and perform simple conversions." },
                        { level: "Medium", text: "I can convert between cubic meters and liters and apply metric prefixes." }
                    ]
                },
                {
                    title: "Projections & Perspectives",
                    skills: [
                        { level: "Mild", text: "I can draw a net and identify which net goes with which shape." },
                        { level: "Medium", text: "I can represent objects using perspective drawings and interpret blueprints." },
                        { level: "Spicy", text: "I can draw different views of a solid from a 3D representation." }
                    ]
                },
                {
                    title: "Similar Figures & Solids",
                    skills: [
                        { level: "Mild", text: "I can identify similar figures and use scale factor to find missing sides." },
                        { level: "Medium", text: "I understand relationships between scale factor (k) and perimeter (k), area (kÂ²), volume (kÂ³)." },
                        { level: "Spicy", text: "I can solve multi-step problems involving similar figures and solids." }
                    ]
                },
                {
                    title: "Equivalent Figures",
                    skills: [
                        { level: "Mild", text: "I can determine if shapes are equivalent by comparing volumes or areas." },
                        { level: "Medium", text: "I can find dimensions for equivalent shapes and apply the concept to practical problems." },
                        { level: "Spicy", text: "I can solve equivalence problems for complex shapes and optimization problems." }
                    ]
                },
                {
                    title: "Pythagorean Theorem",
                    skills: [
                        { level: "Mild", text: "I can identify parts of a triangle and find a missing side." },
                        { level: "Medium", text: "I can solve multi-step questions involving composite figures." },
                        { level: "Spicy", text: "I can find a missing leg in an isosceles triangle." },
                        { level: "Extra Spicy", text: "I can apply 30-60-90 triangle principles and justify calculations." }
                    ]
                }
            ]
        },
        {
            category: "Statistics & Probability",
            topics: [
                {
                    title: "Sampling Methods",
                    skills: [
                        { level: "Mild", text: "I understand census vs sampling." },
                        { level: "Medium", text: "I can identify simple random, stratified, and cluster sampling." },
                        { level: "Spicy", text: "I can suggest sampling methods and identify bias." },
                        { level: "Extra Spicy", text: "I can analyze sampling reliability, evaluate studies, and describe advanced techniques." }
                    ]
                },
                {
                    title: "Mean",
                    skills: [
                        { level: "Mild", text: "I can calculate mean for simple sets." },
                        { level: "Medium", text: "I can calculate mean for decimals and find missing values." },
                        { level: "Spicy", text: "I can calculate weighted mean and mean from frequency tables." },
                        { level: "Extra Spicy", text: "I can analyze when mean is appropriate vs misleading and handle complex weighted means." }
                    ]
                },
                {
                    title: "Mode, Median, Range",
                    skills: [
                        { level: "Mild", text: "I can find mode, median, and range for simple sets." },
                        { level: "Medium", text: "I can find mode/median for larger sets and frequency tables." },
                        { level: "Spicy", text: "I can identify mode from graphs and find median from frequency tables." }
                    ]
                },
                {
                    title: "Quartiles",
                    skills: [
                        { level: "Mild", text: "I understand quartiles and can find Q2 (median)." },
                        { level: "Medium", text: "I can find Q1, Q3, and Interquartile Range (IQR)." },
                        { level: "Spicy", text: "I can calculate quartiles for various sets and frequency tables." }
                    ]
                },
                {
                    title: "Data in Classes",
                    skills: [
                        { level: "Mild", text: "I understand grouping data into categories/intervals." },
                        { level: "Medium", text: "I can identify intervals." },
                        { level: "Spicy", text: "I can organize raw data into classes and create frequency tables." }
                    ]
                },
                {
                    title: "Graphically Representing Data",
                    skills: [
                        { level: "Mild", text: "I recognize histograms and scatterplots." },
                        { level: "Medium", text: "I can interpret histograms and scatterplots and plot points." },
                        { level: "Spicy", text: "I can create histograms, describe distribution shapes, and identify outliers." }
                    ]
                },
                {
                    title: "Box & Whisker Plots",
                    skills: [
                        { level: "Mild", text: "I can recognize box plots and identify box/whiskers." },
                        { level: "Medium", text: "I can identify 5 key values (min, Q1, med, Q3, max) and interpret sections." },
                        { level: "Spicy", text: "I can calculate IQR from a plot and construct a plot." },
                        { level: "Extra Spicy", text: "I can identify outliers, describe skewness, and compare distributions." }
                    ]
                },
                {
                    title: "Probability Types",
                    skills: [
                        { level: "Mild", text: "I can identify discrete vs continuous variables." },
                        { level: "Medium", text: "I can classify variables and understand probability assignment." },
                        { level: "Spicy", text: "I can explain how variable type affects probability calculation." }
                    ]
                },
                {
                    title: "Arrangements & Combinations",
                    skills: [
                        { level: "Mild", text: "I understand order matters in arrangements vs combinations." },
                        { level: "Medium", text: "I can calculate outcomes with/without replacement." }
                    ]
                },
                {
                    title: "Geometric Probability",
                    skills: [
                        { level: "Mild", text: "I understand probability based on length/area." },
                        { level: "Medium", text: "I can calculate probability for 1D and 2D regions." },
                        { level: "Spicy", text: "I can solve multi-step geometric probability problems." }
                    ]
                }
            ]
        }
    ];

    // --- 2. APP LOGIC ---

    // ** SORTING LOGIC **
    const orderMap = { "Mild": 1, "Medium": 2, "Spicy": 3, "Extra Spicy": 4, "Extra": 4 };
    
    curriculumData.forEach(cat => {
        cat.topics.forEach(topic => {
            topic.skills.sort((a, b) => {
                const valA = orderMap[a.level] || 99;
                const valB = orderMap[b.level] || 99;
                return valA - valB;
            });
        });
    });

    const container = document.getElementById('curriculum-container');
    const searchInput = document.getElementById('search-input');
    const coreProgressDisplay = document.getElementById('core-progress');
    const spicyProgressDisplay = document.getElementById('spicy-progress');

    // Storage keys
    const PROGRESS_KEY = 'mathMasteryProgressFullV1';
    const TAB_KEY = 'mathMasteryActiveTab';

    // Load progress
    let userProgress = JSON.parse(localStorage.getItem(PROGRESS_KEY)) || {};

    function saveProgress() {
        try {
            localStorage.setItem(PROGRESS_KEY, JSON.stringify(userProgress));
            calculateTotalProgress();
        } catch (e) {
            console.error(e);
        }
    }

    function calculateTotalProgress() {
        let coreTotal = 0;
        let coreCompleted = 0;
        
        let spicyTotal = 0;
        let spicyCompleted = 0;

        curriculumData.forEach(cat => {
            cat.topics.forEach(topic => {
                topic.skills.forEach((skill, index) => {
                    const safeTitle = topic.title.replace(/[^a-zA-Z0-9]/g, '');
                    const id = `${safeTitle}-${index}`;
                    const isDone = userProgress[id];

                    if (skill.level === "Mild" || skill.level === "Medium") {
                        coreTotal++;
                        if (isDone) coreCompleted++;
                    } else {
                        spicyTotal++;
                        if (isDone) spicyCompleted++;
                    }
                });
            });
        });

        const corePct = coreTotal === 0 ? 0 : Math.round((coreCompleted / coreTotal) * 100);
        coreProgressDisplay.textContent = `${corePct}%`;
        
        const bulbStopYellow = document.getElementById('bulb-stop-yellow');
        const bulbStopGray = document.getElementById('bulb-stop-gray');
        bulbStopYellow.setAttribute('offset', `${corePct}%`);
        bulbStopGray.setAttribute('offset', `${corePct}%`);

        const spicyPct = spicyTotal === 0 ? 0 : Math.round((spicyCompleted / spicyTotal) * 100);
        spicyProgressDisplay.textContent = `${spicyPct}%`;

        const chiliStopRed = document.getElementById('chili-stop-red');
        const chiliStopGray = document.getElementById('chili-stop-gray');
        chiliStopRed.setAttribute('offset', `${spicyPct}%`);
        chiliStopGray.setAttribute('offset', `${spicyPct}%`);
    }

    function renderCurriculum(filterText = '') {
        container.innerHTML = '';
        
        let hasResults = false;

        curriculumData.forEach(cat => {
            const filteredTopics = cat.topics.filter(topic => {
                const matchesTopic = topic.title.toLowerCase().includes(filterText.toLowerCase());
                const matchesSkill = topic.skills.some(s => s.text.toLowerCase().includes(filterText.toLowerCase()));
                return matchesTopic || matchesSkill;
            });

            if (filteredTopics.length === 0) return;
            hasResults = true;

            const catDiv = document.createElement('div');
            catDiv.className = 'bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6';
            
            const catHeader = document.createElement('div');
            catHeader.className = 'bg-slate-100 p-4 border-b border-slate-200 flex justify-between cursor-pointer hover:bg-slate-200 transition group';
            catHeader.innerHTML = `
                <h2 class="text-lg font-bold text-slate-800">${cat.category}</h2>
                <span class="text-slate-500 text-xs font-semibold bg-slate-200 px-2 py-1 rounded">${filteredTopics.length} topics</span>
            `;
            
            catHeader.onclick = () => {
                const content = catDiv.querySelector('.topic-content');
                content.classList.toggle('hidden');
            };

            const contentDiv = document.createElement('div');
            contentDiv.className = 'topic-content p-6 space-y-8';

            filteredTopics.forEach(topic => {
                const topicBlock = document.createElement('div');
                
                const topicTitle = document.createElement('h3');
                topicTitle.className = 'font-bold text-blue-700 text-md mb-4 uppercase tracking-wide border-b border-blue-100 pb-2';
                topicTitle.textContent = topic.title;
                topicBlock.appendChild(topicTitle);

                const grid = document.createElement('div');
                grid.className = 'grid gap-3';

                topic.skills.forEach((skill, index) => {
                    if (filterText && !skill.text.toLowerCase().includes(filterText.toLowerCase()) && !topic.title.toLowerCase().includes(filterText.toLowerCase())) return;

                    const safeTitle = topic.title.replace(/[^a-zA-Z0-9]/g, '');
                    const id = `${safeTitle}-${index}`;
                    const isChecked = userProgress[id] ? 'checked' : '';

                    let badgeClass = 'mild';
                    if(skill.level === 'Medium') badgeClass = 'medium';
                    if(skill.level === 'Spicy') badgeClass = 'spicy';
                    if(skill.level === 'Extra Spicy' || skill.level === 'Extra') badgeClass = 'extra';

                    const card = document.createElement('label');
                    card.className = `flex items-start gap-4 p-4 rounded-lg border border-slate-100 hover:bg-blue-50 transition cursor-pointer select-none ${isChecked ? 'bg-emerald-50 border-emerald-200' : 'bg-white'}`;
                    
                    card.innerHTML = `
                        <div class="pt-1">
                            <input type="checkbox" class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300" 
                                   onchange="toggleSkill('${id}', this)" ${isChecked}>
                        </div>
                        <div class="flex-1">
                            <span class="badge ${badgeClass} mb-2 inline-block">${skill.level}</span>
                            <p class="text-sm text-slate-700 font-medium leading-relaxed">${skill.text}</p>
                        </div>
                    `;
                    grid.appendChild(card);
                });

                topicBlock.appendChild(grid);
                contentDiv.appendChild(topicBlock);
            });

            catDiv.appendChild(catHeader);
            catDiv.appendChild(contentDiv);
            container.appendChild(catDiv);
        });

        if (!hasResults && filterText) {
            container.innerHTML = `<div class="text-center text-gray-500 py-10">No skills found matching "${filterText}"</div>`;
        }
    }

    window.toggleSkill = function(id, checkbox) {
        if (checkbox.checked) {
            userProgress[id] = true;
            checkbox.closest('label').classList.remove('bg-white');
            checkbox.closest('label').classList.add('bg-emerald-50', 'border-emerald-200');
        } else {
            delete userProgress[id];
            checkbox.closest('label').classList.add('bg-white');
            checkbox.closest('label').classList.remove('bg-emerald-50', 'border-emerald-200');
        }
        saveProgress();
    };

    window.resetProgress = function() {
        if(confirm("Are you sure you want to clear all progress?")) {
            userProgress = {};
            saveProgress();
            renderCurriculum(searchInput.value);
        }
    };

    // --- TAB LOGIC ---
    window.switchTab = function(tabName) {
        localStorage.setItem(TAB_KEY, tabName);

        document.getElementById('tab-tracker').classList.add('hidden');
        document.getElementById('tab-docs').classList.add('hidden');
        
        document.getElementById('btn-tracker').classList.remove('border-blue-600', 'text-blue-600');
        document.getElementById('btn-docs').classList.remove('border-blue-600', 'text-blue-600');
        document.getElementById('btn-tracker').classList.add('border-transparent', 'text-slate-600');
        document.getElementById('btn-docs').classList.add('border-transparent', 'text-slate-600');

        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        document.getElementById(`btn-${tabName}`).classList.add('border-blue-600', 'text-blue-600');
        document.getElementById(`btn-${tabName}`).classList.remove('border-transparent', 'text-slate-600');
    }

    searchInput.addEventListener('input', (e) => {
        renderCurriculum(e.target.value);
    });

    // Initialize
    renderCurriculum();
    calculateTotalProgress();
    
    // Restore last open tab or default to tracker
    const lastTab = localStorage.getItem(TAB_KEY) || 'tracker';
    switchTab(lastTab);

    </script>
</body>
</html>
